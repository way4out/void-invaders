<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=no">
  <title>Void Invaders: Mobile Grind</title>
  <meta name="theme-color" content="#000000">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <style>
    * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body {
      background: #000;
      color: #00ff00;
      font-family: 'Orbitron', 'Courier New', monospace;
      overflow: hidden;
      touch-action: manipulation;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    #ui {
      padding: 8px;
      text-align: center;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(10px);
      z-index: 10;
      flex-shrink: 0;
    }
    #prices { font-size: 11px; margin: 4px 0; opacity: 0.9; }
    #gameInfo { font-size: 13px; margin: 6px 0; }
    #canvas {
      flex: 1;
      width: 100vw;
      image-rendering: pixelated;
      touch-action: none;
    }
    #controls {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      background: rgba(0,20,0,0.9);
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      z-index: 20;
    }
    .btn {
      background: linear-gradient(45deg,#00ff00,#008800);
      color: #000;
      border: none;
      padding: 14px 20px;
      margin: 0 8px;
      border-radius: 50px;
      font-weight: bold;
      font-size: 14px;
      flex: 1;
      max-width: 140px;
    }
    #mintBtn { background: linear-gradient(45deg,#ff00ff,#aa00aa); }
    #fireBtn {
      background: radial-gradient(#ffff00,#ff8800);
      border-radius: 50%;
      width: 80px; height: 80px;
      font-size: 32px;
      position: absolute;
      right: 20px;
      bottom: 80px;
    }
    #joystick {
      width: 120px; height: 120px;
      background: rgba(0,255,0,0.15);
      border: 3px solid #00ff00;
      border-radius: 50%;
      position: absolute;
      left: 20px;
      bottom: 70px;
    }
    #knob {
      width: 50px; height: 50px;
      height: 50px;
      background: #00ff00;
      border-radius: 50%;
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      transition: none;
    }
    a { color:#00ff00; text-decoration:none; }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;900&display=swap" rel="stylesheet">
</head>
<body>

  <div id="ui">
    <h1 style="font-size:5vw;margin:0;">Void Invaders</h1>
    <div id="prices">
      <a href="https://base.app/coin/base-mainnet/0x46d4c3d87d66d58e0035cd3b269a41875c06692b" target="_blank">$WAY4OUT</a> <span id="way4out">$0.0012</span> |
      <a href="https://base.app/coin/base-mainnet/0xf097454f9874ce870d0d4cd8d419c3de4e63197e" target="_blank">$A1i3N</a> <span id="a1ien">$0.0005</span> |
      <a href="https://base.app/coin/base-mainnet/0x4deeba0fca2f9a8b307b891241eac57b6bf713ec" target="_blank">$COIN4</a> <span id="coin4">$0.0045</span>
    </div>
    <div id="gameInfo">
      Wallet: <span id="wallet" style="cursor:pointer;color:#00ffff;">Tap to Connect</span><br>
      Shards: <span id="score">0</span> | Wave <span id="wave">1</span> | Kills <span id="kills">0</span>
    </div>
  </div>

  <canvas id="canvas"></canvas>

  <div id="controls">
    <button class="btn" id="mineBtn">MINE</button>
    <button class="btn" id="redeemBtn">REDEEM</button>
    <button class="btn" id="mintBtn">MINT NFT</button>
  </div>

  <!-- Mobile touch controls -->
  <div id="joystick"><div id="knob"></div></div>
  <button id="fireBtn">FIRE</button>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let w, h;

    function resize() {
      w = canvas.width = window.innerWidth;
      h = canvas.height = window.innerHeight - document.getElementById('ui').offsetHeight - 80;
    }
    window.onresize = resize; resize();

    // Game state
    let score = 0, kills = 0, wave = 1, mining = false;
    const player = { x: w/2, y: h-80, w: 40, h: 30, speed: 8 };
    let enemies = [], bullets = [], particles = [];
    let connectedWallet = null;

    // Touch controls
    const joystick = document.getElementById('joystick');
    const knob = document.getElementById('knob');
    let touchId = null, baseX, baseY;

    joystick.addEventListener('touchstart', e => {
      if (touchId) return;
      const t = e.changedTouches[0];
      touchId = t.identifier;
      baseX = t.clientX; baseY = t.clientY;
      e.preventDefault();
    });

    document.addEventListener('touchmove', e => {
      if (!touchId) return;
      for (let t of e.changedTouches) {
        if (t.identifier === touchId) {
          const dx = (t.clientX - baseX) / 3;
          const dy = (t.clientY - baseY) / 3;
          player.x = Math.max(20, Math.min(w-60, w/2 + dx));
          knob.style.transform = `translate(${dx}px, ${dy}px)`;
          break;
        }
      }
      e.preventDefault();
    });

    document.addEventListener('touchend', e => {
      for (let t of e.changedTouches) {
        if (t.identifier === touchId) {
          touchId = null;
          knob.style.transform = 'translate(-50%,-50%)';
        }
      }
    });

    document.getElementById('fireBtn').addEventListener('touchstart', e => {
      shoot();
      e.preventDefault();
    });

    // Keyboard fallback
    const keys = {};
    onkeydown = onkeyup = e => keys[e.key.toLowerCase()] = e.type === 'keydown';

    // Simple sound
    function beep(f=440,d=80){ const a=new AudioContext(),o=a.createOscillator(),g=a.createGain();o.connect(g);g.connect(a.destination);o.frequency.value=f;o.start();g.gain.exponentialRampToValueAtTime(0.01,a.currentTime+d/1000);o.stop(a.currentTime+d/1000); }

    function shoot() {
      bullets.push({x: player.x+player.w/2-2, y: player.y, w:4, h:12, s:12});
      beep(800,60);
    }

    function spawnEnemy() {
      enemies.push({
        x: Math.random()*(w-50)+25,
        y: -40,
        w: 40, h: 30,
        s: 1 + wave*0.4,
        type: Math.random()<0.35 ? 'a1ien' : 'basic'
      });
    }

    function update() {
      if (keys['arrowleft'] || keys['a']) player.x -= player.speed;
      if (keys['arrowright'] || keys['d']) player.x += player.speed;
      if (keys[' ']) shoot();

      player.x = Math.max(10, Math.min(w-player.w-10, player.x));

      if (Math.random() < 0.03 + wave*0.01) spawnEnemy();

      bullets.forEach((b,i)=>{ b.y-=b.s; if(b.y<0) bullets.splice(i,1); });
      enemies.forEach((e,i)=>{
        e.y += e.s;
        if (e.y > h) { gameOver(); return; }
        if (Math.random()<0.01) bullets.push({x:e.x+e.w/2,y:e.y+e.h,w:4,h:10,s:-6});
      });

      // Collision
      bullets.forEach((b,bi)=>{
        enemies.forEach((e,ei)=>{
          if (b.x>e.x&&b.x<e.x+e.w && b.y>e.y&&b.y<e.y+e.h){
            particles.push(...Array.from({length:15},()=>({x:e.x+e.w/2,y:e.y+e.h/2,vx:(Math.random()-0.5)*12,vy:(Math.random()-0.5)*12,l:1,c:e.type==='a1ien'?'#ff00ff':'#ff0066'})));
            enemies.splice(ei,1);
            bullets.splice(bi,1);
            score += e.type==='a1ien'?40:10;
            kills++;
            if(kills%12===0) wave++;
            beep(600,80);
          }
        });
      });

      particles = particles.filter(p=>{ p.x+=p.vx; p.y+=p.vy; p.l-=0.03; return p.l>0; });

      if(mining) score += 0.15;

      document.getElementById('score').textContent = Math.floor(score);
      document.getElementById('wave').textContent = wave;
      document.getElementById('kills').textContent = kills;

      requestAnimationFrame(update);
    }

    function draw() {
      ctx.fillStyle='#000428'; ctx.fillRect(0,0,w,h);
      // stars
      ctx.fillStyle='#fff';
      for(let i=0;i<80;i++) ctx.fillRect((i*123)%w,(i*91+Date.now()/50)%h,2,2);

      // player
      ctx.fillStyle = '#00ff00';
      ctx.beginPath();
      ctx.moveTo(player.x+player.w/2, player.y);
      ctx.lineTo(player.x, player.y+player.h);
      ctx.lineTo(player.x+player.w, player.y+player.h);
      ctx.closePath(); ctx.fill();

      // bullets
      ctx.fillStyle='#ffff00'; bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
      // enemies
      enemies.forEach(e=>{
        ctx.fillStyle = e.type==='a1ien'?'#ff00ff':'#ff0066';
        ctx.fillRect(e.x,e.y,e.w,e.h);
        ctx.fillStyle='#00ff00';
        ctx.fillRect(e.x+8,e.y+8,6,6); ctx.fillRect(e.x+26,e.y+8,6,6);
      });
      // particles
      particles.forEach(p=>{ ctx.globalAlpha=p.l; ctx.fillStyle=p.c; ctx.fillRect(p.x,p.y,6,6); });
      ctx.globalAlpha=1;

      requestAnimationFrame(draw);
    }

    function gameOver(){
      alert(`VOID BREACHED\nShards: ${Math.floor(score)}\nWave ${wave} | Kills ${kills}\nMint your NFT now!`);
      location.reload();
    }

    // Buttons
    document.getElementById('wallet').onclick = () => {
      connectedWallet = "0xCeA5...2D74"; // demo
      document.getElementById('wallet').textContent = "0xCeA5...2D74";
      alert("Wallet connected (demo)");
    };
    document.getElementById('mineBtn').onclick = () => { mining=!mining; this.textContent=mining?"MINING...":"MINE"; };
    document.getElementById('redeemBtn').onclick = () => alert(`Redeemed ${Math.floor(score/60)} $WAY4OUT\n${Math.floor(score/120)} $A1i3N\nCheck wallet!`);
    document.getElementById('mintBtn').onclick = () => { if(score<150) return alert("Need 150+ shards"); alert("Zora NFT Minted to 0xCeA57...2D74!"); score-=150; };

    // Start
    setInterval(() => {
      document.getElementById('way4out').textContent = '$'+(0.0012+Math.random()*0.0008).toFixed(4);
      document.getElementById('a1ien').textContent = '$'+(0.0005+Math.random()*0.0004).toFixed(4);
    }, 3000);

    update();
    draw();
  </script>
</body>
</html>
